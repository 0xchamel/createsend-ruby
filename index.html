<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>createsend-ruby by campaignmonitor</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>createsend-ruby</h1>
        <p>A Ruby library for the Campaign Monitor API</p>

        <p class="view"><a href="https://github.com/campaignmonitor/createsend-ruby">View the Project on GitHub <small>campaignmonitor/createsend-ruby</small></a></p>


        <ul>
          <li><a href="https://github.com/campaignmonitor/createsend-ruby/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/campaignmonitor/createsend-ruby/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/campaignmonitor/createsend-ruby">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="createsend" class="anchor" href="#createsend"><span class="octicon octicon-link"></span></a>createsend</h1>

<p><a href="http://travis-ci.org/campaignmonitor/createsend-ruby"><img src="https://secure.travis-ci.org/campaignmonitor/createsend-ruby.png" alt="Build Status"></a> <a href="https://coveralls.io/r/campaignmonitor/createsend-ruby"><img src="https://coveralls.io/repos/campaignmonitor/createsend-ruby/badge.png?branch=master" alt="Coverage Status"></a> <a href="https://gemnasium.com/campaignmonitor/createsend-ruby"><img src="https://gemnasium.com/campaignmonitor/createsend-ruby.png" alt="Dependency Status"></a> <a href="http://badge.fury.io/rb/createsend"><img src="https://badge.fury.io/rb/createsend.png" alt="Gem Version"></a></p>

<p>A Ruby library which implements the complete functionality of the <a href="http://www.campaignmonitor.com/api/">Campaign Monitor API</a>.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>To install:</p>

<pre><code>gem install createsend
</code></pre>

<p>Or, add a dependency to your <code>Gemfile</code> then <code>bundle install</code>.</p>

<div class="highlight"><pre><span class="n">gem</span> <span class="s1">'createsend'</span>
</pre></div>

<h2>
<a name="authenticating" class="anchor" href="#authenticating"><span class="octicon octicon-link"></span></a>Authenticating</h2>

<p>The Campaign Monitor API supports authentication using either OAuth or an API key.</p>

<h3>
<a name="using-oauth" class="anchor" href="#using-oauth"><span class="octicon octicon-link"></span></a>Using OAuth</h3>

<p>If you're developing a Rails or Rack based application, we recommend using <a href="https://github.com/jdennes/omniauth-createsend">omniauth-createsend</a> to authenticate with the Campaign Monitor API. You might find this <a href="https://github.com/jdennes/createsendoauthtest">example application</a> helpful.</p>

<p>If you don't use <a href="https://github.com/jdennes/omniauth-createsend">omniauth-createsend</a>, you'll need to get access tokens for your users by following the instructions included in the Campaign Monitor API <a href="http://www.campaignmonitor.com/api/getting-started/#authenticating_with_oauth">documentation</a>. This gem provides functionality to help you do this, as described below. There's also another <a href="https://gist.github.com/jdennes/4945412">example application</a> you may wish to reference, which doesn't depend on any OAuth libraries.</p>

<h4>
<a name="redirecting-to-the-authorization-url" class="anchor" href="#redirecting-to-the-authorization-url"><span class="octicon octicon-link"></span></a>Redirecting to the authorization URL</h4>

<p>The first thing your application should do is redirect your user to the Campaign Monitor authorization URL where they will have the opportunity to approve your application to access their Campaign Monitor account. You can get this authorization URL by using <code>CreateSend::CreateSend.authorize_url</code>, like so:</p>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'createsend'</span>

<span class="n">authorize_url</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:CreateSend</span><span class="o">.</span><span class="n">authorize_url</span><span class="p">(</span>
  <span class="s1">'Client ID for your application'</span><span class="p">,</span>
  <span class="s1">'Redirect URI for your application'</span><span class="p">,</span>
  <span class="s1">'The permission level your application requires'</span><span class="p">,</span>
  <span class="s1">'Optional state data to be included'</span>
<span class="p">)</span>
<span class="c1"># Redirect your users to authorize_url.</span>
</pre></div>

<h4>
<a name="exchanging-an-oauth-code-for-an-access-token" class="anchor" href="#exchanging-an-oauth-code-for-an-access-token"><span class="octicon octicon-link"></span></a>Exchanging an OAuth code for an access token</h4>

<p>If your user approves your application, they will then be redirected to the <code>redirect_uri</code> you specified, which will include a <code>code</code> parameter, and optionally a <code>state</code> parameter in the query string. Your application should implement a handler which can exchange the code passed to it for an access token, using <code>CreateSend::CreateSend.exchange_token</code> like so:</p>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'createsend'</span>

<span class="n">access_token</span><span class="p">,</span> <span class="n">expires_in</span><span class="p">,</span> <span class="n">refresh_token</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:CreateSend</span><span class="o">.</span><span class="n">exchange_token</span><span class="p">(</span>
  <span class="s1">'Client ID for your application'</span><span class="p">,</span>
  <span class="s1">'Client Secret for your application'</span><span class="p">,</span>
  <span class="s1">'Redirect URI for your application'</span><span class="p">,</span>
  <span class="s1">'A unique code for your user'</span> <span class="c1"># Get the code parameter from the query string</span>
<span class="p">)</span>
<span class="c1"># Save access_token, expires_in, and refresh_token.</span>
</pre></div>

<p>At this point you have an access token and refresh token for your user which you should store somewhere convenient so that your application can look up these values when your user wants to make future Campaign Monitor API calls.</p>

<h4>
<a name="making-api-calls-using-an-access-token" class="anchor" href="#making-api-calls-using-an-access-token"><span class="octicon octicon-link"></span></a>Making API calls using an access token</h4>

<p>Once you have an access token and refresh token for your user, you can use the <code>createsend</code> gem to authenticate and make further API calls like so:</p>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'createsend'</span>

<span class="n">auth</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="s1">'your access token'</span><span class="p">,</span>
  <span class="ss">:refresh_token</span> <span class="o">=&gt;</span> <span class="s1">'your refresh token'</span>
<span class="p">}</span>
<span class="n">cs</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:CreateSend</span><span class="o">.</span><span class="n">new</span> <span class="n">auth</span>
<span class="n">clients</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">clients</span>
</pre></div>

<h4>
<a name="refreshing-access-tokens" class="anchor" href="#refreshing-access-tokens"><span class="octicon octicon-link"></span></a>Refreshing access tokens</h4>

<p>All OAuth access tokens have an expiry time, and can be renewed with a refresh token. If your access token expires when attempting to make an API call, the <code>CreateSend::ExpiredOAuthToken</code> exception will be raised, so your code should handle this. You can handle this using either <code>CreateSend::CreateSend.refresh_access_token</code> (when calling class methods) or <code>CreateSend::CreateSend#refresh_token</code> (when calling instance methods).</p>

<p>Here's an example of using <code>CreateSend::CreateSend#refresh_token</code> to refresh your current access token when calling <code>CreateSend::CreateSend#clients</code>:</p>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'createsend'</span>

<span class="n">auth</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="s1">'your access token'</span><span class="p">,</span>
  <span class="ss">:refresh_token</span> <span class="o">=&gt;</span> <span class="s1">'your refresh token'</span>
<span class="p">}</span>
<span class="n">cs</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:CreateSend</span><span class="o">.</span><span class="n">new</span> <span class="n">auth</span>

<span class="k">begin</span>
  <span class="n">tries</span> <span class="o">||=</span> <span class="mi">2</span>
  <span class="n">clients</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">clients</span>
  <span class="k">rescue</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:ExpiredOAuthToken</span> <span class="o">=&gt;</span> <span class="n">eot</span>
    <span class="n">access_token</span><span class="p">,</span> <span class="n">expires_in</span><span class="p">,</span> <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">refresh_token</span>
    <span class="c1"># Here you should save your updated access token, 'expire in' value,</span>
    <span class="c1"># and refresh token. `cs` will automatically have the new access token</span>
    <span class="c1"># set, so there is no need to set it again.</span>
    <span class="k">retry</span> <span class="k">unless</span> <span class="p">(</span><span class="n">tries</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zero?</span>
    <span class="nb">p</span> <span class="s2">"Error: </span><span class="si">#{</span><span class="n">eot</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">p</span> <span class="s2">"Error: </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div>

<p>In addition to raising <code>CreateSend::ExpiredOAuthToken</code> when an access token has expired, this library also raises <code>CreateSend::InvalidOAuthToken</code> if an invalid access token is used, and raises <code>CreateSend::RevokedOAuthToken</code> if a user has revoked the access token being used. This makes it easier for you to handle these cases in your code.</p>

<h3>
<a name="using-an-api-key" class="anchor" href="#using-an-api-key"><span class="octicon octicon-link"></span></a>Using an API key</h3>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'createsend'</span>

<span class="n">cs</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:CreateSend</span><span class="o">.</span><span class="n">new</span> <span class="ss">:api_key</span> <span class="o">=&gt;</span> <span class="s1">'your api key'</span>
<span class="n">clients</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">clients</span>
</pre></div>

<h2>
<a name="basic-usage" class="anchor" href="#basic-usage"><span class="octicon octicon-link"></span></a>Basic usage</h2>

<p>This example of listing all your clients and their campaigns demonstrates basic usage of the library and the data returned from the API:</p>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'createsend'</span>

<span class="n">auth</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="s1">'your access token'</span><span class="p">,</span>
  <span class="ss">:refresh_token</span> <span class="o">=&gt;</span> <span class="s1">'your refresh token'</span>
<span class="p">}</span>
<span class="n">cs</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:CreateSend</span><span class="o">.</span><span class="n">new</span> <span class="n">auth</span>

<span class="n">clients</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">clients</span>
<span class="n">clients</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">cl</span><span class="o">|</span>
  <span class="nb">p</span> <span class="s2">"Client: </span><span class="si">#{</span><span class="n">cl</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">client</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:Client</span><span class="o">.</span><span class="n">new</span> <span class="n">auth</span><span class="p">,</span> <span class="n">cl</span><span class="o">.</span><span class="n">ClientID</span>
  <span class="nb">p</span> <span class="s2">"- Campaigns:"</span>
  <span class="n">client</span><span class="o">.</span><span class="n">campaigns</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">cm</span><span class="o">|</span>
    <span class="nb">p</span> <span class="s2">"  - </span><span class="si">#{</span><span class="n">cm</span><span class="o">.</span><span class="n">Subject</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Running this example will result in something like:</p>

<pre><code>Client: First Client
- Campaigns:
  - Newsletter Number One
  - Newsletter Number Two
Client: Second Client
- Campaigns:
  - News for January 2013
</code></pre>

<h2>
<a name="handling-errors" class="anchor" href="#handling-errors"><span class="octicon octicon-link"></span></a>Handling errors</h2>

<p>If the Campaign Monitor API returns an error, an exception will be raised. For example, if you attempt to create a campaign and enter empty values for subject and other required fields:</p>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'createsend'</span>

<span class="n">auth</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:access_token</span> <span class="o">=&gt;</span> <span class="s1">'your access token'</span><span class="p">,</span>
  <span class="ss">:refresh_token</span> <span class="o">=&gt;</span> <span class="s1">'your refresh token'</span>
<span class="p">}</span>

<span class="k">begin</span>
  <span class="nb">id</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:Campaign</span><span class="o">.</span><span class="n">create</span> <span class="n">auth</span><span class="p">,</span> <span class="s2">"4a397ccaaa55eb4e6aa1221e1e2d7122"</span><span class="p">,</span>
    <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="o">[]</span><span class="p">,</span> <span class="o">[]</span>
  <span class="nb">p</span> <span class="s2">"New campaign ID: </span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">rescue</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:BadRequest</span> <span class="o">=&gt;</span> <span class="n">br</span>
    <span class="nb">p</span> <span class="s2">"Bad request error: </span><span class="si">#{</span><span class="n">br</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">p</span> <span class="s2">"Error Code:    </span><span class="si">#{</span><span class="n">br</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Code</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">p</span> <span class="s2">"Error Message: </span><span class="si">#{</span><span class="n">br</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Message</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">p</span> <span class="s2">"Error: </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div>

<p>Running this example will result in:</p>

<pre><code>Bad request error: The CreateSend API responded with the following error - 304: Campaign Subject Required
Error Code:    304
Error Message: Campaign Subject Required
</code></pre>

<h2>
<a name="expected-input-and-output" class="anchor" href="#expected-input-and-output"><span class="octicon octicon-link"></span></a>Expected input and output</h2>

<p>The best way of finding out the expected input and output of a particular method in a particular class is to use the unit tests as a reference.</p>

<p>For example, if you wanted to find out how to call the CreateSend::Subscriber.add method, you would look at the file test/subscriber_test.rb</p>

<div class="highlight"><pre><span class="n">should</span> <span class="s2">"add a subscriber with custom fields"</span> <span class="k">do</span>
  <span class="n">stub_post</span><span class="p">(</span><span class="vi">@auth</span><span class="p">,</span> <span class="s2">"subscribers/</span><span class="si">#{</span><span class="vi">@list_id</span><span class="si">}</span><span class="s2">.json"</span><span class="p">,</span> <span class="s2">"add_subscriber.json"</span><span class="p">)</span>
  <span class="n">custom_fields</span> <span class="o">=</span> <span class="o">[</span> <span class="p">{</span> <span class="ss">:Key</span> <span class="o">=&gt;</span> <span class="s1">'website'</span><span class="p">,</span> <span class="ss">:Value</span> <span class="o">=&gt;</span> <span class="s1">'http://example.com/'</span> <span class="p">}</span> <span class="o">]</span>
  <span class="n">email_address</span> <span class="o">=</span> <span class="ss">CreateSend</span><span class="p">:</span><span class="ss">:Subscriber</span><span class="o">.</span><span class="n">add</span> <span class="vi">@auth</span><span class="p">,</span> <span class="vi">@list_id</span><span class="p">,</span> <span class="s2">"subscriber@example.com"</span><span class="p">,</span> <span class="s2">"Subscriber"</span><span class="p">,</span> <span class="n">custom_fields</span><span class="p">,</span> <span class="kp">true</span>
  <span class="n">email_address</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">"subscriber@example.com"</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<p>Full documentation is hosted by <a href="http://rubydoc.info/gems/createsend/frames">RubyDoc.info</a>.</p>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Please check the <a href="https://github.com/campaignmonitor/createsend-ruby/blob/master/CONTRIBUTING.md">guidelines for contributing</a> to this repository.</p>

<h2>
<a name="releasing" class="anchor" href="#releasing"><span class="octicon octicon-link"></span></a>Releasing</h2>

<p>Please check the <a href="https://github.com/campaignmonitor/createsend-ruby/blob/master/RELEASE.md">instructions for releasing</a> the <code>createsend</code> gem.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/campaignmonitor">campaignmonitor</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>